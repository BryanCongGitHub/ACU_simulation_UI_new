# 时速 160 公里内燃动力车辅助变流系统通信协议（ACU 与 INV 及 BCC 间）
&gt; 当前版本：Rev.1.6  
&gt; 等价版本：1.22  
&gt;
&gt; 编制：  
&gt; 校核：  
&gt; 审核：  
&gt; 批准：

---

## 目录
1. [范围](#范围)
2. [参考文件](#参考文件)
3. [缩略词](#缩略词)
4. [通信方式](#通信方式)
   - 4.1 [过程数据](#过程数据)
   - 4.2 [IP 地址](#ip地址)
   - 4.3 [传输方式](#传输方式)
   - 4.4 [子网掩码和默认网关](#子网掩码和默认网关)
   - 4.5 [UDP/IP 报文格式](#udpip报文格式)
   - 4.6 [通讯大小端](#通讯大小端)
5. [通信内容](#通信内容)
   - 5.1 [ACU 发送至 INV/CHU/BCC 数据报文](#acu发送至invchubcc数据报文)
   - 5.2 [INV/CHU/BCC 发送至 ACU 数据报文](#invchubcc发送至acu数据报文)
   - 5.3 [INV/CHU/BCC 发送至 ACU 数据报文数据定义](#invchubcc发送至acu数据报文数据定义)
6. [修改记录](#修改记录)

---

## 范围
本文件描述了时速 160 公里内燃动力车项目辅助控制基板 ACU 同 INV、BCC 间的接口定义。

---

## 参考文件
1. IEC 61375-1：2007《列车通信网络》  
2. IEC 61375-2-3：2015《轨道交通电气设备-列车通信网络 第 2-3 部分：TCN 通信协议》  
3. IEC 61375-3-4：2014《轨道交通电气设备-列车通信网络 第 3-4 部分: 固定编组以太网 ECN》

---

## 缩略词
| 缩略词 | 描述 |
|--------|------|
| INV | INV UNIT |
| CHU | CHU UNIT |
| BCC | battery charger |
| ACU | ACU Unit |
| ECN | Ethernet Consist Network |
| TRDP | Train Real-Time Data Protocol |
| UDP | User Datagram Protocol |

---

## 通信方式
以太网通信协议采用符合 IEC 61375-2-3 Ed.1.0 标准的 UDP 协议实现。  
IP 地址分配采用符合 IEC 61375-3-4 Ed.1.0 标准的方式设置。  
MAC 地址采用 IEEE 注册机构提供的方法生成，确保通信设备的 MAC 地址不会有重复。

固定入网的终端设备及交换机以太网通信端口配置为强制百兆全双工。  
接收终端的数据接收周期需要与发送终端的数据发送周期保持一致。

### 过程数据
过程数据主要应用于充电机控制和状态监视。链路层保证数据的完整性。传输数据延迟应小于 10 ms。  
过程数据优先级采用标准规定的第二优先级。过程数据基于 UDP 多播传输。过程数据的收发采用 IEC 61375-2-3 Ed.1.0 标准中的 PUSH 模式。

### IP 地址
| 设备 | IP Address | 接收端口 | 发送端口 |
|------|------------|----------|----------|
| ACU | 10.2.0.1 | 49153 ~ 49162 | 49152 |
| INV1 | 10.2.0.2 | 49152 | 49153 |
| INV2 | 10.2.0.3 | 49152 | 49154 |
| INV3 | 10.2.0.4 | 49152 | 49155 |
| INV4 | 10.2.0.5 | 49152 | 49156 |
| INV5 | 10.2.0.6 | 49152 | 49157 |
| INV6 | 10.2.0.7 | 49152 | 49158 |
| CHU3 | 10.2.0.8 | 49152 | 49159 |
| CHU4 | 10.2.0.9 | 49152 | 49160 |
| BCC1 | 10.2.0.10 | 49152 | 49161 |
| BCC2 | 10.2.0.11 | 49152 | 49162 |

### 传输方式
ACU/BCC 发送数据地址列表：

| 源设备 | 宿设备 | IP 地址 | 周期 | 数据长度 (octets) | 传输方式 |
|--------|--------|---------|------|-------------------|----------|
| ACU | INV1~6, CHU3, CHU4, BCC1, BCC2 | 239.255.34.1 | 20 ms | 320 | 组播 |
| INV1~6, CHU3, CHU4, BCC1, BCC2 | ACU | 10.2.0.1 | 100 ms | 64 | 单播 |

&gt; 数据长度不含报文头 Header。

### 子网掩码和默认网关
子网掩码：24 位（255.255.255.0）

### UDP/IP 报文格式
1. **Preamble**：同步序列 `10101010` ×7  
2. **Start Frame Delimiter**：`10101011`  
3. **Ethernet Header**：目的 MAC 6 B + 源 MAC 6 B + 类型 2 B  
4. **IP Header**（RFC 791）  
5. **UDP Header**（RFC 768）  
6. **DataSet**：应用数据，见第 5 章  
7. **PAD**：填充  
8. **FCS**：帧校验序列

### 通讯大小端
所有数据流均采用 **大端（Big-Endian）** 发送；小端设备需在软件中转换。

---

## 通信内容

### ACU 发送至 INV/CHU/BCC 数据报文（320 B）
| 字节 | 位 | 类型 | 信号名 | 描述 | 备注 |
|------|----|------|--------|------|------|
| 0 | 0–15 | UINT | CCU_Life | 生命信号 | 0–65535 |
| 2–7 | 0–7 | BYTE | 年/月/日/时/分/秒 | 时间戳 | 所有单元 |
| 8 | 0–7 | Bool | 均衡充电模式、停止工作、预发车测试… | 控制位 | 见文档 bit 位定义 |
| 9 | 0–7 | Bool | 故障复位、空压机启动、除尘风机… | 接触器指令 | 同上 |
| 10–15 | 0–15 | UINT | INV2–INV5 给定频率 | 0.1 Hz/LSB | 频率控制 |
| 64–67 | 0–7 | Bool | INV1–INV6、BCC1/2 隔离/启动指令 | 单 bit | 逐 bit 定义 |
| 142–152 | 0–15 | UINT | 启动时间、支路电压、电池温度 | 0.1 s/0.1 V/0.1 ℃ | 预留部分 |

完整位定义见原 Word 表。

### INV/CHU/BCC 发送至 ACU 数据报文（64 B）
| 字节 | 类型 | 信号名 | 备注 |
|------|------|--------|------|
| 0–1 | UINT | 生命信号 | 0–65535 |
| 2–5 | UINT | 软件编号/版本 | 例 0x102 = V1.0.2 |
| 6–7 | UINT | 输出频率/调制比/电压 | 见单元类型 |
| 8–15 | UINT | 三相电流、输入电压、风机电流… | 比例 0.25 A/0.25 V |
| 48–51 | BOOL | 状态/故障位 | 逐 bit 定义，见原表 |
| 52–63 | BOOL | 扩展故障、接触器状态 | 同上 |

比例系数：  
电流 1 LSB = 0.25 A；电压 1 LSB = 0.25 V；温度 1 LSB = 0.1 ℃；压力 1 LSB = 0.1 kPa。

### 数据定义通则
| 项目 | 定义 | 备注 |
|------|------|------|
| 软件编号 | 0x102 → V1.0.2 | 例 |
| 数字量 | 0=无效；1=有效 |  |
| 接触器/断路器 | 0=断开；1=闭合 |  |

---

## 修改记录
| 序号 | 日期 | 变更人 | 页码 | 内容 |
|------|------|--------|------|------|
| 1.0 | 2023.12.15 | 潘磊 | — | 初版发行 |
| 1.1 | 2023.12.16 | 潘磊 | 4,12,15 | 组播→单播；KM68 状态定义 |
| 1.2 | 2023.12.31 | 潘磊 | 4,6,11 | ACU 发信改回组播；增加停止工作/预发车测试指令及反馈 |
| 1.3 | 2024.1.22 | 潘磊 | 7,8 | TEXT9/65/66 位定义变更；支路电压定义变更 |
| 1.4 | 2024.2.26 | 潘磊 | 10,4-5 | 增加 IPM 温度；发送周期 20 ms→100 ms |
| 1.5 | 2024.4.19 | 王慧 | 8,11-15 | 追加 INV5 冗余启动及模拟量/接触器信号 |
| 1.6 | 2025.3.25 | 潘磊 | 16 | TEXT52-B7 增加 IPM 电压异常 |
